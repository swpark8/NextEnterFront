# 알림 시스템 테스트 가이드

## 🧪 테스트 시나리오

### 시나리오 1: 새로운 지원자 알림

#### 준비
1. 기업 계정으로 로그인
2. 개인 계정으로 별도 브라우저 또는 시크릿 모드로 로그인

#### 테스트 단계
1. **개인 계정**에서:
   - 채용정보 > 모든 공고로 이동
   - 특정 공고 선택
   - "지원하기" 버튼 클릭
   - 이력서 선택 후 제출

2. **기업 계정**에서:
   - 헤더의 알림 아이콘 확인
   - 빨간 배지에 숫자 "1" 표시 확인
   - 알림 아이콘 클릭
   - "새로운 지원자" 알림 확인

#### 예상 결과
```
제목: 새로운 지원자
내용: '[공고명]' 포지션에 새로운 지원자가 있습니다.
시간: 방금 전
```

---

### 시나리오 2: 지원 상태 변경 알림

#### 준비
1. 개인 계정으로 이미 지원한 상태
2. 기업 계정으로 로그인

#### 테스트 단계
1. **기업 계정**에서:
   - 지원자 관리로 이동
   - 특정 지원자 선택
   - 상태를 "서류합격"으로 변경
   - 저장

2. **개인 계정**에서:
   - 헤더의 알림 아이콘 확인
   - 빨간 배지에 숫자 "1" 표시 확인
   - 알림 아이콘 클릭
   - "지원 상태 변경" 알림 확인

#### 예상 결과
```
제목: 지원 상태 변경
내용: [기업명] 지원서가 '서류 합격'(으)로 변경되었습니다.
시간: 방금 전
```

---

### 시나리오 3: 알림 설정 테스트

#### 테스트 단계
1. 마이페이지 > 알림 설정으로 이동
2. "새로운 지원자 발생 시 알림" 토글을 OFF로 변경
3. 설정 저장
4. 시나리오 1을 다시 수행
5. 알림이 오지 않는 것을 확인

6. 다시 알림 설정에서 토글을 ON으로 변경
7. 설정 저장
8. 시나리오 1을 다시 수행
9. 알림이 정상적으로 오는 것을 확인

---

## 🔍 디버깅 체크리스트

### 프론트엔드
- [ ] 브라우저 콘솔에서 "✅ WebSocket Connected" 로그 확인
- [ ] 네트워크 탭에서 WebSocket 연결 확인 (ws://localhost:8080/ws/notifications)
- [ ] useWebSocket 훅의 `connected` 상태가 `true`인지 확인
- [ ] 알림 수신 시 "📬 새 알림 수신:" 로그 확인

### 백엔드
- [ ] 애플리케이션 로그에서 "✅ WebSocket Connected" 로그 확인
- [ ] `notifyNewApplication` 메서드 호출 로그 확인
- [ ] `NotificationService` 로그 확인:
  ```
  알림 생성: userId=X, type=NEW_APPLICATION, title=새로운 지원자
  웹소켓 알림 전송: /topic/notifications/company/X
  ```

### 데이터베이스
```sql
-- 알림 설정 확인
SELECT * FROM notification_settings WHERE user_id = ? AND user_type = ?;

-- 알림 데이터 확인
SELECT * FROM notifications WHERE user_id = ? AND user_type = ? ORDER BY created_at DESC;

-- 읽지 않은 알림 개수
SELECT COUNT(*) FROM notifications WHERE user_id = ? AND user_type = ? AND is_read = false;
```

---

## 🐛 자주 발생하는 문제

### 1. WebSocket 연결 실패
**증상**: 콘솔에 "❌ STOMP Error" 또는 "❌ WebSocket Disconnected" 표시

**해결 방법**:
- 백엔드가 8080 포트에서 실행 중인지 확인
- `WebSocketConfig.java`에서 CORS 설정 확인
- 방화벽 설정 확인

### 2. 알림이 수신되지 않음
**증상**: 액션 수행 후 알림이 오지 않음

**해결 방법**:
1. 알림 설정이 활성화되어 있는지 확인
2. WebSocket 연결이 정상인지 확인
3. 백엔드 로그에서 `NotificationService` 호출 확인
4. 데이터베이스에 알림이 생성되었는지 확인

### 3. 배지 숫자가 업데이트되지 않음
**증상**: 알림을 읽었는데 배지가 사라지지 않음

**해결 방법**:
1. 알림 팝업을 열어서 알림 항목을 클릭
2. "모두 읽음" 버튼 클릭
3. 페이지 새로고침

### 4. 브라우저 알림이 표시되지 않음
**증상**: WebSocket 알림은 오지만 브라우저 알림이 표시되지 않음

**해결 방법**:
1. 브라우저 설정에서 알림 권한 확인
2. useWebSocket 훅에서 `Notification.requestPermission()` 호출
3. 사이트 설정에서 알림이 차단되어 있지 않은지 확인

---

## 📊 성능 모니터링

### WebSocket 연결 수
```javascript
// 브라우저 콘솔에서 실행
console.log('WebSocket 상태:', window.performance.getEntriesByType('resource')
  .filter(r => r.name.includes('ws://')));
```

### 메모리 사용량
```javascript
// 메모리 프로파일링
console.log('메모리 사용량:', performance.memory);
```

### 알림 처리 시간
```java
// NotificationService에 타이밍 로그 추가
long startTime = System.currentTimeMillis();
// ... 알림 전송 코드
log.info("알림 전송 소요 시간: {}ms", System.currentTimeMillis() - startTime);
```

---

## ✅ 테스트 완료 체크리스트

### 기본 기능
- [ ] WebSocket 연결 성공
- [ ] 새로운 지원자 알림 수신
- [ ] 지원 상태 변경 알림 수신
- [ ] 알림 읽음 처리
- [ ] 모두 읽음 처리
- [ ] 알림 설정 변경
- [ ] 알림 배지 숫자 업데이트

### 고급 기능
- [ ] 여러 알림 동시 수신
- [ ] 페이지 새로고침 후 알림 개수 유지
- [ ] 로그아웃 후 WebSocket 연결 해제
- [ ] 다시 로그인 시 WebSocket 재연결
- [ ] 네트워크 단절 후 자동 재연결

### UI/UX
- [ ] 알림 아이콘 호버 효과
- [ ] 알림 팝업 애니메이션
- [ ] 알림 항목 호버 효과
- [ ] 읽지 않은 알림 배지 표시
- [ ] 상대적 시간 표시 (예: "5분 전")

---

## 🎓 추가 개선 사항

### 우선순위 높음
1. ✅ 공고 마감 임박 알림 자동 발송 (배치 작업)
2. ✅ 면접 제안/수락/거절 알림
3. ✅ 포지션 제안 알림

### 우선순위 중간
1. 알림 필터링 (읽음/안 읽음)
2. 알림 검색 기능
3. 알림 페이지네이션
4. 알림 삭제 기능

### 우선순위 낮음
1. 이메일 알림 연동
2. 푸시 알림 (모바일 앱)
3. 알림 스누즈 기능
4. 알림 우선순위 설정
